# 计算机启动流程
&ensp;&ensp; 首先来说一说计算机的工作模式。在Intel芯片中，从8086到如今(2023年)，工作方式也一直发生着改变，从实模式（16位）到保护模式（32位）在到长模式（64位）。
Intel为了系统的兼容，前两种工作模式也一直保留着，需要开启不同的系统寄存器才可以开起cpu不同的工作方式。好的，进入正题，说一说计算机如何启动的。
计算机开启的第一条指令属于BIOS程序。此时，cpu工作在实模式下，20位的数据总线只能限制访问在1MB的内存范围内。这1MB的内存视图如下图所是。所谓内存视图也就是在1MB的内存中那些地址中有什么东东。
![Alt text](image/image.png)

&ensp;&ensp;执行第一条指令的地址：`0xFFFF0~0XFFFFF`,对应的指令如下：
```asm
jmp far f000:e50b
```
f000*4+e50b也就是说才是bios程序的正式入口。好的，现在bios从该地址开始运行，在运行过程中对各种硬件进行检测，并且加载引导程序。

`引导程序`：使用CHS对磁盘描述，另外一种是LBA。在0盘0道1扇区上，最后一个字是0x55aa的程序。

首先bios会对该磁盘进行检测，查看是否满足引导程序的标准（检测末尾是不是0x55aa），如果满足那么则将这这段程序加载到内存`0x7c00`的内存上。在这里加载的时候，使用汇编程序对这个扇区的内容读取，然后复制到0x7c00的内存开始的内存中，总共512个字节。这段引导程序也称为`MBR`,即主引导记录。

`q`:如果0扇区末尾是0x55aa，但是前面的数据都是随机的，如何处理，这里1扇区满足引导程序标准

说到这里，我们是不是觉得要开始进入操作系统了，no。可以思考一下，操作系统最次也要32位模式下吧，这里才16位，不够看呐，那么我们还得进入操作系统前对环境进行初始化。还有最主要的一点，我们的操作系统只有在内存中才能开始运行，所以我们需要将磁盘或者U启动盘上的内核程序加载到内存中。而负责这些工作的程序起个名字，就叫加载器吧，也就是`loader`程序。
既然loader属于程序，那么程序就需要存在于内存中，那么谁来加载loader程序呢，当然得MBR来加载咯。

好的，现在我们开始对全局进行一个概括，使用流程图描述计算机启动流程。
![Alt text](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%9B%BE.png)

